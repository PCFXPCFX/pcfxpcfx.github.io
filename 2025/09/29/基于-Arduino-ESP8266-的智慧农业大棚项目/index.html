<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>基于 Arduino ESP8266 的智慧农业大棚项目 | pcfx</title><meta name="keywords" content="嵌入式"><meta name="author" content="pcfx,pcfx@qq.com"><meta name="copyright" content="pcfx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="基于 Arduino ESP8266 的智慧农业大棚项目"><meta name="application-name" content="基于 Arduino ESP8266 的智慧农业大棚项目"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="基于 Arduino ESP8266 的智慧农业大棚项目"><meta property="og:url" content="http://example.com/2025/09/29/%E5%9F%BA%E4%BA%8E-Arduino-ESP8266-%E7%9A%84%E6%99%BA%E6%85%A7%E5%86%9C%E4%B8%9A%E5%A4%A7%E6%A3%9A%E9%A1%B9%E7%9B%AE/index.html"><meta property="og:site_name" content="pcfx"><meta property="og:description" content="基于 Arduino ESP8266 的智慧农业大棚项目引言 为什么做智慧大棚项目 我参加了一个大学大创相关的团队，团队主题是智慧农业大棚，我是负责技术相关的。 虽然这个团队更偏向于做ppt，写调查报告，甚至有点吹牛逼的成分在里面，但是我还是决心坚持做出点成果，能弄出一个技术相关的方案。 这个方案可"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://pcfx.oss-cn-heyuan.aliyuncs.com/markdown/img/seed_image.png"><meta property="article:author" content="pcfx"><meta property="article:tag" content=""><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://pcfx.oss-cn-heyuan.aliyuncs.com/markdown/img/seed_image.png"><meta name="description" content="基于 Arduino ESP8266 的智慧农业大棚项目引言 为什么做智慧大棚项目 我参加了一个大学大创相关的团队，团队主题是智慧农业大棚，我是负责技术相关的。 虽然这个团队更偏向于做ppt，写调查报告，甚至有点吹牛逼的成分在里面，但是我还是决心坚持做出点成果，能弄出一个技术相关的方案。 这个方案可"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/09/29/%E5%9F%BA%E4%BA%8E-Arduino-ESP8266-%E7%9A%84%E6%99%BA%E6%85%A7%E5%86%9C%E4%B8%9A%E5%A4%A7%E6%A3%9A%E9%A1%B9%E7%9B%AE/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: undefined,
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["😭️ 希望每天都开心！"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: pcfx","link":"链接: ","source":"来源: pcfx","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'pcfx',
  title: '基于 Arduino ESP8266 的智慧农业大棚项目',
  postAI: '',
  pageFillDescription: '基于 Arduino ESP8266 的智慧农业大棚项目, 引言, 项目硬件介绍, 核心控制器：ESP8266, 传感器部分, 项目设计与功能, 总结与展望基于的智慧农业大棚项目引言为什么做智慧大棚项目我参加了一个大学大创相关的团队团队主题是智慧农业大棚我是负责技术相关的虽然这个团队更偏向于做写调查报告甚至有点吹牛逼的成分在里面但是我还是决心坚持做出点成果能弄出一个技术相关的方案这个方案可能在很多计算机大佬面前可能看起来很简单甚至弱智但是这里面都是我不断自学不断挑战自我做出来的成果也同样是我自己成长的一个记录希望有一天我成为一个大佬后看到我的项目也能会心一笑能轻松说出当年误区和弯路的优势我选择作为微控制器有如下原因我有部分的开发经验当年小学玩过而能使用开发且自带模块太极创客太极创客人工智能物联网的应用开发和学习资料是我的启蒙老师之一而他们有完备的教程本文目标分享硬件组成与基本功能包括硬件部分的设计和网络的连接项目硬件介绍核心控制器我选用的是和硬件参考太极创客教程一致的开发板串口芯片是版本我对这块开发板其实很满意作为新手来说已经很足够了不过美中不足的是它只有一个模拟输入口原本我打算用无源光敏电阻来检测光照但土壤湿度传感器必须占用这个模拟口所以我最终选择了走接口的光照传感器传感器部分下图是我很早之前用画的图接线可能与后文不太对的上实物图我原先选择的是传感器想着刚好有太极创客的教程可以参考但是按照教程一走发现的精度实在是不太让人满意温度只能输出整数故选择了我是用的是库在库管理能直接下载示例代码核心代码如下下面两行代码放到空气质量传感器检测使用的是库同样在能直接下示例代码核心代码需要注意的是开机后需要预热一段时间数值才能趋于稳定和乙醇的获取是带有实验性质的没有经过校准只能作为相对参考单位为单位为和乙醇的单位为函数填入的是摄氏度和到的相对湿度绝对湿度有其矫正函数可以适用光照强度传感器测量光照接口使用库也同样能在库管理下载我使用了示例里面的能高精度自动选择量程测量时间寄存器在高亮度下不超量程防止溢出在低亮度下能提高灵敏度测量微弱光线除了能选择高精度选择测量时间寄存器还能选择工作模式是单次还是连续具体的可以去上的看看就不一一列举了核心代码光照读取错误可选根据光照强度调整调试打印光照注意返回值为没有从传感器传输有效数据可能是通信错误返回值为配置错误土壤湿度传感器测量土壤含水量模拟信号本项目用的是最简单的模拟土壤湿度传感器按道理来说应该没什么可讲的但是看资料的时候看到了这一条里面引起了我的注意是所以我简单制作了一个分压电路使用和的电阻进行分压使土壤湿度传感器在短路时分到的电压在伏特附近对获取模拟口的范围是所以经过分压后当探针断路时模拟口分压为左右所以获得数值在左右代码模拟引脚用于土壤湿度检测使用这个函数就能调用的模拟数值项目设计与功能各传感器与的连接方式土壤湿度检测放到了模拟口放到了口也就是和共用总线网络与数据传输我的项目采用协议传输使用的代码基于太极创客的教程使用的是服务器以下是太极创客关于传输的示范案例项目名称零基础入门学用物联网程序名称团队太极创客团队作者朔日期程序目的本程序旨在演示如何使用库使用向服务器发布信息本示例程序为太极创客团队制作的零基础入门学用物联网中示例程序该教程为对物联网开发感兴趣的朋友所设计和制作如需了解更多该教程的信息请参考以下网页设置接入信息请根据您的信息进行修改如以上服务器无法正常连接请前往以下页面寻找解决方案计数用变量设置工作模式为无线终端模式连接设置服务器和端口号连接服务器定时对象如果开发板成功连接服务器每隔秒钟发布一次信息保持心跳如果开发板未能成功连接服务器则尝试连接服务器根据的地址生成客户端避免与其它的客户端重名连接服务器发布信息客户端发布信息用数字建立发布主题主题名称以为前缀后面添加设备的地址这么做是为确保不同用户进行信息发布时客户端名称各不相同建立发布信息信息内容以为起始后面添加发布次数实现向主题发布信息连接等待连接成功连接后输出成功信息当然也能从服务器订阅消息但是我的项目暂时对这个功能没要求如果需要可以上太极创客官网学习我想增强的传输安全性想使用双向验证注意由于我无法访问后面的教程都是基于的修改成双向我们需要同步时间时间不同步会导致失败我们可以在里面校时等待直到时间同步在连接上后调用将换成原来改成准备好三个证书根证书你上传后生成的客户端证书本地生成的私钥第一个证书在这个页面下载第三个证书需要自己生成跟随指引然后在第二个网址上传自己生成好的就能生成并下载证书把它们粘贴进代码里根证书的证书客户端证书你上传后下载到的客户端私钥你本地生成的初始化改服务器端口成数据转化成字符串发送项目代码节选创建文档到这里数据就转换成格式的字符串了总结与展望项目成果项目实现了数据采集并实时上传使用加密学习了协议可以拓展的方向后端尚未开发可以开发后端硬件与预想时剔除了水泵但是扩展板存在电机驱动电路可以添加上若要添加水泵可以采用订阅参考资料太极创客人工智能物联网的应用开发和学习资料',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-09-29 22:33:44',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/image/pcfx.png"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">pcfx</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/%E5%AD%A6%E4%B9%A0"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/projects/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 项目</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=2038751471&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于网站</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size: 1.05rem;">AI<sup>1</sup></a><a href="/tags/C-C/" style="font-size: 1.05rem;">C/C++<sup>1</sup></a><a href="/tags/GitHub/" style="font-size: 1.05rem;">GitHub<sup>1</sup></a><a href="/tags/Markdown/" style="font-size: 1.05rem;">Markdown<sup>1</sup></a><a href="/tags/MySQL/" style="font-size: 1.05rem;">MySQL<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>1</sup></a><a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" style="font-size: 1.05rem;">嵌入式<sup>1</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 1.05rem;">数学<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">算法<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">九月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>嵌入式</span></a></span></div></div><h1 class="post-title" itemprop="name headline">基于 Arduino ESP8266 的智慧农业大棚项目</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-09-29T08:39:02.000Z" title="发表于 2025-09-29 16:39:02">2025-09-29</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-09-29T14:33:44.144Z" title="更新于 2025-09-29 22:33:44">2025-09-29</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为河源"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>河源</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://pcfx.oss-cn-heyuan.aliyuncs.com/markdown/img/seed_image.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/09/29/%E5%9F%BA%E4%BA%8E-Arduino-ESP8266-%E7%9A%84%E6%99%BA%E6%85%A7%E5%86%9C%E4%B8%9A%E5%A4%A7%E6%A3%9A%E9%A1%B9%E7%9B%AE/"><header><a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" tabindex="-1" itemprop="url">嵌入式</a><h1 id="CrawlerTitle" itemprop="name headline">基于 Arduino ESP8266 的智慧农业大棚项目</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">pcfx</span><time itemprop="dateCreated datePublished" datetime="2025-09-29T08:39:02.000Z" title="发表于 2025-09-29 16:39:02">2025-09-29</time><time itemprop="dateCreated datePublished" datetime="2025-09-29T14:33:44.144Z" title="更新于 2025-09-29 22:33:44">2025-09-29</time></header><h1 id="基于-Arduino-ESP8266-的智慧农业大棚项目"><a href="#基于-Arduino-ESP8266-的智慧农业大棚项目" class="headerlink" title="基于 Arduino ESP8266 的智慧农业大棚项目"></a>基于 Arduino ESP8266 的智慧农业大棚项目</h1><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><ul>
<li><p><strong>为什么做智慧大棚项目</strong></p>
<p>我参加了一个<strong>大学大创</strong>相关的<strong>团队</strong>，团队<strong>主题是智慧农业大棚</strong>，我是负责技术相关的。</p>
<p>虽然这个团队更偏向于做ppt，写调查报告，甚至有点吹牛逼的成分在里面，但是我还是决心坚持做出点成果，能弄出一个技术相关的方案。</p>
<p>这个方案可能在很多计算机大佬面前可能看起来很 <strong>”简单”</strong> 甚至 <strong>“弱智”</strong>，但是这里面都是我不断自学，不断挑战自我做出来的成果，也同样是我自己成长的一个记录。</p>
<p>希望有一天我成为一个大佬后，看到我的项目也能会心一笑，能轻松说出当年误区和弯路。</p>
</li>
<li><p><strong>ESP8266 的优势</strong></p>
<p>我选择esp8266作为微控制器有如下原因：</p>
<ul>
<li>我有部分arduino uno R3的开发经验，当年小学玩过arduino scratch。而esp8266能使用arduino开发且自带Wi-Fi模块。</li>
<li>太极创客（<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/">太极创客 – Arduino，人工智能，物联网的应用、开发和学习资料</a>）是我arduino的启蒙老师之一。而他们有完备的esp8266教程。</li>
</ul>
</li>
<li><p><strong>本文目标</strong></p>
<p>分享硬件组成与基本功能。包括硬件部分的设计，和MQTT网络的连接。</p>
</li>
</ul>
<h2 id="项目硬件介绍"><a href="#项目硬件介绍" class="headerlink" title="项目硬件介绍"></a>项目硬件介绍</h2><h3 id="核心控制器：ESP8266"><a href="#核心控制器：ESP8266" class="headerlink" title="核心控制器：ESP8266"></a>核心控制器：ESP8266</h3><ul>
<li>我选用的是和<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/reference-index/arduino-hardware-refrence/nodemcu/">ESP8266-NodeMCU硬件参考 – 太极创客</a>教程一致的开发板。串口芯片是cp2102版本。</li>
<li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pcfx.oss-cn-heyuan.aliyuncs.com/markdown/img/esp8266_devkit_horizontal-01.png" alt="NodeMCU-Pin-Layout">我对这块开发板其实很满意，作为新手来说已经很足够了。不过美中不足的是它只有一个模拟输入口（A0)。原本我打算用无源光敏电阻来检测光照，但土壤湿度传感器必须占用这个模拟口，所以我最终选择了走 I²C 接口的 GY-302 光照传感器。</li>
</ul>
<h3 id="传感器部分"><a href="#传感器部分" class="headerlink" title="传感器部分"></a>传感器部分</h3><p>​	下图是我很早之前用 <em><strong>Fritzing</strong></em>画的图，接线可能与后文不太对的上。</p>
<p>​	<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pcfx.oss-cn-heyuan.aliyuncs.com/markdown/img/image-20250926194145931.png" alt="image-20250926194145931"></p>
<p>实物图:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pcfx.oss-cn-heyuan.aliyuncs.com/markdown/img/image-20250926194159307.png" alt="image-20250926194159307"></p>
<ul>
<li><p><strong>DHT22</strong></p>
<p>我原先选择的是DHT11传感器，想着刚好有<a target="_blank" rel="noopener" href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-iot-dev-ref/esp8266-sensor-ref/dht11-esp8266-ref/">太极创客的DHT11教程</a>可以参考。</p>
<p>但是按照教程一走，发现<strong>DHT11的精度实在是不太让人满意，温度只能输出整数 ，故选择了DHT22。</strong></p>
<p>我是用的是<a target="_blank" rel="noopener" href="https://github.com/dvarrel/DHT22">github.com&#x2F;dvarrel&#x2F;DHT22</a> DHT22库，在arduino库管理能直接下载。</p>
<p>示例代码：<a target="_blank" rel="noopener" href="https://github.com/dvarrel/DHT22/blob/main/examples/dht22test/dht22test.ino">DHT22&#x2F;examples&#x2F;dht22test dvarrel&#x2F;DHT22 · GitHub</a></p>
<p>核心代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;DHT22.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pinDATA SDA <span class="comment">// SDA, or almost any other I/O pin</span></span></span><br><span class="line"><span class="function">DHT22 <span class="title">dht22</span><span class="params">(pinDATA)</span></span>; </span><br><span class="line"><span class="comment">//下面两行代码放到loop()</span></span><br><span class="line">  <span class="type">float</span> t = dht<span class="number">22.</span><span class="built_in">getTemperature</span>();</span><br><span class="line">  <span class="type">float</span> h = dht<span class="number">22.</span><span class="built_in">getHumidity</span>();</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>SGP30</strong>：空气质量传感器（CO₂、VOC检测）</p>
<p>使用的是<a target="_blank" rel="noopener" href="https://github.com/RobTillaart/SGP30">GitHub - RobTillaart&#x2F;SGP30: Arduino library for SGP30 environment sensor</a>库，同样在arduino能直接下。</p>
<p>示例代码：<a target="_blank" rel="noopener" href="https://github.com/RobTillaart/SGP30/blob/master/examples/SGP30_demo/SGP30_demo.ino">SGP30&#x2F;examples&#x2F;SGP30_demo&#x2F;SGP30_demo.ino at master · RobTillaart&#x2F;SGP30 · GitHub</a></p>
<p>核心代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;SGP30.h&quot;</span></span></span><br><span class="line">SGP30 SGP;</span><br><span class="line">Wire.<span class="built_in">begin</span>();</span><br><span class="line">SGP.<span class="built_in">GenericReset</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//setRelHumidity(float T, float RH) sets the compensation for temperature (5-55°C) and relative humidity (10-95%). These values can be obtained e.g. from an SHT30, DHT22 or similar sensor. </span></span><br><span class="line"><span class="comment">//  T  in °C</span></span><br><span class="line"><span class="comment">//  RH == 0..100</span></span><br><span class="line">SGP.<span class="built_in">setRelHumidity</span>(<span class="type">float</span> T, <span class="type">float</span> RH);</span><br><span class="line">    </span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;\nTVOC \teCO2 \tH2 \tETH&quot;</span>);</span><br><span class="line">  Serial.<span class="built_in">print</span>(SGP.<span class="built_in">getTVOC</span>());</span><br><span class="line">  Serial.<span class="built_in">print</span>(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">  Serial.<span class="built_in">print</span>(SGP.<span class="built_in">getCO2</span>());</span><br><span class="line">  Serial.<span class="built_in">print</span>(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">  Serial.<span class="built_in">print</span>(SGP.<span class="built_in">getH2</span>());</span><br><span class="line">  Serial.<span class="built_in">print</span>(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">  Serial.<span class="built_in">print</span>(SGP.<span class="built_in">getEthanol</span>());</span><br><span class="line">  Serial.<span class="built_in">println</span>();</span><br></pre></td></tr></table></figure>
</li>
<li><p>需要注意的是：</p>
<ol>
<li>开机后<strong>需要预热</strong>一段时间，数值才能趋于稳定。</li>
<li><strong>H2 和乙醇</strong>的获取是带有<strong>实验性质的</strong>，没有经过校准，只能作为相对参考。</li>
<li>CO2 单位为 ppm，TVOC 单位为 ppb。H2 和乙醇的单位为 ppm。</li>
<li>setRelHumidity(float T, float RH)函数填入的是摄氏度和1到100的相对湿度，绝对湿度有其矫正函数可以适用。</li>
</ol>
</li>
<li><p><strong>GY-302（BH1750光照强度传感器）</strong>：测量光照，I²C接口</p>
<p>使用<a target="_blank" rel="noopener" href="https://github.com/claws/BH1750">GitHub - claws&#x2F;BH1750</a> 库，也同样能在arduino库管理下载。</p>
<p>我使用了示例里面的<a target="_blank" rel="noopener" href="https://github.com/claws/BH1750/blob/master/examples/BH1750autoadjust/BH1750autoadjust.ino">BH1750autoadjust</a> 能高精度，自动选择量程（测量时间寄存器)，在高亮度下不超量程，防止溢出，在低亮度下能提高灵敏度，测量微弱光线。</p>
<p>除了能选择高精度，选择测量时间寄存器(Measurement Time Register,MTreg) ，还能选择工作模式是单次还是连续。</p>
<p>具体的可以去GitHub上的README.md看看，就不一一列举了。</p>
<p>核心代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;BH1750.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Wire.h&gt;</span></span></span><br><span class="line">BH1750 lightMeter;</span><br><span class="line">Wire.<span class="built_in">begin</span>();</span><br><span class="line">lightMeter.<span class="built_in">begin</span>(BH1750::ONE_TIME_HIGH_RES_MODE);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (lightMeter.<span class="built_in">measurementReady</span>(<span class="literal">true</span>)) </span><br><span class="line"> &#123;</span><br><span class="line">  <span class="type">float</span> lux = lightMeter.<span class="built_in">readLightLevel</span>();</span><br><span class="line">  <span class="keyword">if</span> (lux &lt; <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="built_in">F</span>(<span class="string">&quot;[system] 光照读取错误!&quot;</span>));  </span><br><span class="line">  &#125; </span><br><span class="line">  <span class="comment">// 可选：根据光照强度调整 MTreg</span></span><br><span class="line">  <span class="keyword">if</span> (lux &gt; <span class="number">40000.0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">  lightMeter.<span class="built_in">setMTreg</span>(<span class="number">32</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (lux &gt; <span class="number">10.0</span>) </span><br><span class="line">  &#123;</span><br><span class="line">  lightMeter.<span class="built_in">setMTreg</span>(<span class="number">69</span>);</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">else</span> </span><br><span class="line">  &#123;</span><br><span class="line">  lightMeter.<span class="built_in">setMTreg</span>(<span class="number">138</span>);</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="comment">// 调试打印</span></span><br><span class="line">    Serial.<span class="built_in">print</span>(<span class="string">&quot;[system] 光照: &quot;</span>);</span><br><span class="line">    Serial.<span class="built_in">print</span>(data.light);</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot; lx&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li>返回值为-1：没有从传感器传输有效数据。可能是通信错误。</li>
<li>返回值为-2：配置错误。</li>
</ul>
</li>
<li><p><strong>土壤湿度传感器</strong>：测量土壤含水量，模拟信号。</p>
</li>
</ul>
<p>​	本项目用的是最简单的模拟土壤湿度传感器，按道理来说应该没什么可讲的。但是看资料的时候看到了这一条。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pcfx.oss-cn-heyuan.aliyuncs.com/markdown/img/image-20250927091637778.png" alt="image-20250927091637778"></p>
<p>里面 <strong>Input voltage range is 0 - 1.0 v</strong>引起了我的注意，esp8266 VCC 是3.3v。所以我简单制作了一个分压电路，使用1kΩ和2.2kΩ的电阻进行分压。</p>
<p>使土壤湿度传感器在短路时，分到A0的电压在1.0伏特附近。</p>
<p>arduino对获取模拟口的范围是0-1024 所以经过分压后，当探针断路时，模拟口分压为1v左右，所以获得数值在<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAAbCAMAAAD4SXfwAAAAAXNSR0IArs4c6QAAAJBQTFRFAAAAAAAAAAA6AABmADpmADqQAGa2OgAAOgBmOjoAOjpmOjqQOmaQOma2OpDbZgA6ZjoAZjo6Zma2ZpC2ZpDbZrbbZrb/kDoAkDo6kDpmkGY6kGZmkJA6kLa2kLbbkNv/tmYAtmY6tmZmtpA6tpBmttv/tv/btv//25A625Bm27Zm2////7Zm/9uQ//+2///bwOYiOwAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAZdEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAABPElEQVQ4T+VTXVeDMAxt6GDqXP0aVee0w007yTb+/78zaUAL7Hg4+OTxPkBPc29ySYJSfxj51XG0e7x9/oVaKfc/1RkA7E43HS/3IZAnMC3pjXd0+BCuSyT2BVvI/WslVyQKDJeUykwPCtNNpYzcYSrvb2C6jpMutu86MLL7SnnNMYLXweh8JbEIflK0HPnAwJT5nEKM8J0tJNaRLyV1U4cZUq1RZ+zB3RxFTT1j1HyXcPAHtXkgCzg7UM696VT3enWqNmeU2qbgp61LttV+sgsNbtcOQvl4S2Ink+l9tzCiQdYMC6XKaWLKsW0jjempm3k/1d29IIPnvByLBK5JTDNmBLXX0B141LCBR5wBLOvlGiiJp/JY+TOyNRovzWKPyOB189uMEJPkrb+yQxPRDDHtLfxQNc4BZHtG4BPPWBy8IzagHAAAAABJRU5ErkJggg==" alt="img"> 左右。</p>
<p>代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> analogInPin A0 <span class="comment">//模拟引脚，用于土壤湿度检测</span></span></span><br><span class="line"><span class="built_in">analogRead</span>(analogInPin)</span><br></pre></td></tr></table></figure>

<p>使用这个函数就能调用analogInPin的模拟数值。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pcfx.oss-cn-heyuan.aliyuncs.com/markdown/img/image-20250926194611938.png" alt="image-20250926194611938"></p>
<h2 id="项目设计与功能"><a href="#项目设计与功能" class="headerlink" title="项目设计与功能"></a>项目设计与功能</h2><ul>
<li><p>各传感器与 ESP8266 的连接方式</p>
<ul>
<li>土壤湿度检测放到了A0模拟口。</li>
<li>DHT22放到了 GPIO 2口也就是D4</li>
<li>GY302和SGP30 共用 iic总线<ul>
<li>D1 SCL</li>
<li>D2 SDA</li>
</ul>
</li>
</ul>
</li>
<li><p>WiFi 网络与数据传输</p>
<ul>
<li><p>我的项目采用mqtt协议传输，使用的代码基于太极创客的mqtt教程。</p>
</li>
<li><p>使用的是<code>test.mosquitto.org</code> 服务器。</p>
<p>以下是太极创客关于mqtt传输的示范案例：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**********************************************************************</span></span><br><span class="line"><span class="comment">项目名称/Project          : 零基础入门学用物联网</span></span><br><span class="line"><span class="comment">程序名称/Program name     : publish_ranye_url</span></span><br><span class="line"><span class="comment">团队/Team                : 太极创客团队 / Taichi-Maker (www.taichi-maker.com)</span></span><br><span class="line"><span class="comment">作者/Author              : CYNO朔</span></span><br><span class="line"><span class="comment">日期/Date（YYYYMMDD）     : 20200813</span></span><br><span class="line"><span class="comment">程序目的/Purpose          : </span></span><br><span class="line"><span class="comment">本程序旨在演示如何使用PubSubClient库使用ESP8266向MQTT服务器发布信息。</span></span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">本示例程序为太极创客团队制作的《零基础入门学用物联网》中示例程序。</span></span><br><span class="line"><span class="comment">该教程为对物联网开发感兴趣的朋友所设计和制作。如需了解更多该教程的信息，请参考以下网页：</span></span><br><span class="line"><span class="comment">http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/http-request/</span></span><br><span class="line"><span class="comment">***********************************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;PubSubClient.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Ticker.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 设置wifi接入信息(请根据您的WiFi信息进行修改)</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;taichi-maker&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* mqttServer = <span class="string">&quot;test.ranye-iot.net&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 如以上MQTT服务器无法正常连接，请前往以下页面寻找解决方案</span></span><br><span class="line"><span class="comment">// http://www.taichi-maker.com/public-mqtt-broker/</span></span><br><span class="line"> </span><br><span class="line">Ticker ticker;</span><br><span class="line">WiFiClient wifiClient;</span><br><span class="line"><span class="function">PubSubClient <span class="title">mqttClient</span><span class="params">(wifiClient)</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> count;    <span class="comment">// Ticker计数用变量</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Serial.<span class="built_in">begin</span>(<span class="number">9600</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//设置ESP8266工作模式为无线终端模式</span></span><br><span class="line">  WiFi.<span class="built_in">mode</span>(WIFI_STA);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 连接WiFi</span></span><br><span class="line">  <span class="built_in">connectWifi</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 设置MQTT服务器和端口号</span></span><br><span class="line">  mqttClient.<span class="built_in">setServer</span>(mqttServer, <span class="number">1883</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接MQTT服务器</span></span><br><span class="line">  <span class="built_in">connectMQTTServer</span>();</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// Ticker定时对象</span></span><br><span class="line">  ticker.<span class="built_in">attach</span>(<span class="number">1</span>, tickerCount);  </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123; </span><br><span class="line">  <span class="keyword">if</span> (mqttClient.<span class="built_in">connected</span>()) &#123; <span class="comment">// 如果开发板成功连接服务器</span></span><br><span class="line">    <span class="comment">// 每隔3秒钟发布一次信息</span></span><br><span class="line">    <span class="keyword">if</span> (count &gt;= <span class="number">3</span>)&#123;</span><br><span class="line">      <span class="built_in">pubMQTTmsg</span>();</span><br><span class="line">      count = <span class="number">0</span>;</span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="comment">// 保持心跳</span></span><br><span class="line">    mqttClient.<span class="built_in">loop</span>();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;                  <span class="comment">// 如果开发板未能成功连接服务器</span></span><br><span class="line">    <span class="built_in">connectMQTTServer</span>();    <span class="comment">// 则尝试连接服务器</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tickerCount</span><span class="params">()</span></span>&#123;</span><br><span class="line">  count++;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">connectMQTTServer</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">// 根据ESP8266的MAC地址生成客户端ID（避免与其它ESP8266的客户端ID重名）</span></span><br><span class="line">  String clientId = <span class="string">&quot;esp8266-&quot;</span> + WiFi.<span class="built_in">macAddress</span>();</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 连接MQTT服务器</span></span><br><span class="line">  <span class="keyword">if</span> (mqttClient.<span class="built_in">connect</span>(clientId.<span class="built_in">c_str</span>())) &#123; </span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;MQTT Server Connected.&quot;</span>);</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;Server Address: &quot;</span>);</span><br><span class="line">    Serial.<span class="built_in">println</span>(mqttServer);</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;ClientId:&quot;</span>);</span><br><span class="line">    Serial.<span class="built_in">println</span>(clientId);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.<span class="built_in">print</span>(<span class="string">&quot;MQTT Server Connect Failed. Client State:&quot;</span>);</span><br><span class="line">    Serial.<span class="built_in">println</span>(mqttClient.<span class="built_in">state</span>());</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">3000</span>);</span><br><span class="line">  &#125;   </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 发布信息</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pubMQTTmsg</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="type">static</span> <span class="type">int</span> value; <span class="comment">// 客户端发布信息用数字</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 建立发布主题。主题名称以Taichi-Maker-为前缀，后面添加设备的MAC地址。</span></span><br><span class="line">  <span class="comment">// 这么做是为确保不同用户进行MQTT信息发布时，ESP8266客户端名称各不相同，</span></span><br><span class="line">  String topicString = <span class="string">&quot;Taichi-Maker-Pub-&quot;</span> + WiFi.<span class="built_in">macAddress</span>();</span><br><span class="line">  <span class="type">char</span> publishTopic[topicString.<span class="built_in">length</span>() + <span class="number">1</span>];  </span><br><span class="line">  <span class="built_in">strcpy</span>(publishTopic, topicString.<span class="built_in">c_str</span>());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 建立发布信息。信息内容以Hello World为起始，后面添加发布次数。</span></span><br><span class="line">  String messageString = <span class="string">&quot;Hello World &quot;</span> + <span class="built_in">String</span>(value++); </span><br><span class="line">  <span class="type">char</span> publishMsg[messageString.<span class="built_in">length</span>() + <span class="number">1</span>];   </span><br><span class="line">  <span class="built_in">strcpy</span>(publishMsg, messageString.<span class="built_in">c_str</span>());</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 实现ESP8266向主题发布信息</span></span><br><span class="line">  <span class="keyword">if</span>(mqttClient.<span class="built_in">publish</span>(publishTopic, publishMsg))&#123;</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;Publish Topic:&quot;</span>);Serial.<span class="built_in">println</span>(publishTopic);</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;Publish message:&quot;</span>);Serial.<span class="built_in">println</span>(publishMsg);    </span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;Message Publish Failed.&quot;</span>); </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ESP8266连接wifi</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">connectWifi</span><span class="params">()</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">  WiFi.<span class="built_in">begin</span>(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//等待WiFi连接,成功连接后输出成功信息</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.<span class="built_in">status</span>() != WL_CONNECTED) &#123;</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">1000</span>);</span><br><span class="line">    Serial.<span class="built_in">print</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;WiFi Connected!&quot;</span>);  </span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;&quot;</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当然，esp8266也能从服务器订阅消息，但是我的项目暂时对这个功能没要求。</p>
<p>如果需要，可以上太极创客官网学习。</p>
<p>我想增强mqtt的传输安全性，想使用双向TLS验证。</p>
<p>注意：由于我无法访问<code>test.ranye-iot.net</code> 后面的教程都是基于<a target="_blank" rel="noopener" href="https://test.mosquitto.org/">test.mosquitto.org</a>的。</p>
<ul>
<li><p>修改成双向TLS</p>
<ol>
<li><p>我们需要同步时间，时间不同步会导致TLS失败</p>
<p>我们可以在<code>setup()</code> 里面校时</p>
</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setupTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">configTime</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="string">&quot;pool.ntp.org&quot;</span>, <span class="string">&quot;time.nist.gov&quot;</span>);</span><br><span class="line">  <span class="type">time_t</span> now = <span class="built_in">time</span>(<span class="literal">nullptr</span>);</span><br><span class="line">  <span class="keyword">while</span> (now &lt; <span class="number">8</span> * <span class="number">3600</span> * <span class="number">2</span>) &#123; <span class="comment">// 等待直到时间同步</span></span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">    now = <span class="built_in">time</span>(<span class="literal">nullptr</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Current time: %s\n&quot;</span>, <span class="built_in">ctime</span>(&amp;now));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在连接上Wi-Fi后，调用<code>setupTime();</code></p>
<ol start="2">
<li>将<code>WiFiClient</code>换成 <code>WiFiClientSecureBearSSL</code></li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClientSecureBearSSL.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原来：WiFiClient wifiClient;</span></span><br><span class="line"><span class="comment">// 改成：</span></span><br><span class="line">BearSSL::WiFiClientSecure wifiClient;</span><br><span class="line"><span class="function">PubSubClient <span class="title">mqttClient</span><span class="params">(wifiClient)</span></span>;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>准备好三个证书</p>
<ul>
<li><p><code>mosquitto.org.crt</code>（CA 根证书）-</p>
</li>
<li><p><code>client.crt</code>（你上传 CSR 后生成的客户端证书）</p>
</li>
<li><p><code>client.key</code>（本地生成的私钥）</p>
<blockquote>
<p>第一个CA证书在这个页面下载<a target="_blank" rel="noopener" href="https://test.mosquitto.org/">test.mosquitto.org</a></p>
<p>第三个证书需要自己生成 跟随<a target="_blank" rel="noopener" href="https://test.mosquitto.org/ssl/">Generate client certificates for test.mosquitto.org </a>指引</p>
<p>然后在第二个网址上传自己生成好的CSR，就能生成并下载CRT证书</p>
</blockquote>
</li>
</ul>
</li>
<li><p>把它们粘贴进代码里：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根证书</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> ca_cert[] PROGMEM = <span class="string">R&quot;EOF(</span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">... test.mosquitto.org 的 CA 证书 ...</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端证书</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> client_cert[] PROGMEM = <span class="string">R&quot;EOF(</span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">... 你上传 CSR 后下载到的 client.crt ...</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端私钥</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> client_key[] PROGMEM = <span class="string">R&quot;EOF(</span></span><br><span class="line"><span class="string">-----BEGIN RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">... 你本地生成的 client.key ...</span></span><br><span class="line"><span class="string">-----END RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">)EOF&quot;</span>;</span><br></pre></td></tr></table></figure>

</li>
<li><p>初始化BearSSL</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BearSSL::X509List <span class="title">cert</span><span class="params">(ca_cert)</span></span>;</span><br><span class="line">wifiClient.<span class="built_in">setTrustAnchors</span>(&amp;cert);</span><br><span class="line"></span><br><span class="line"><span class="function">BearSSL::X509List <span class="title">client_crt</span><span class="params">(client_cert)</span></span>;</span><br><span class="line"><span class="function">BearSSL::PrivateKey <span class="title">key</span><span class="params">(client_key)</span></span>;</span><br><span class="line">wifiClient.<span class="built_in">setClientRSACert</span>(&amp;client_crt, &amp;key);</span><br></pre></td></tr></table></figure>
</li>
<li><p>改服务器端口成8884</p>
</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
<li><p>数据转化成JSON字符串发送</p>
<p>项目代码节选：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ArduinoJson.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Data</span> &#123;</span><br><span class="line">    <span class="type">float</span> air_tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="type">float</span> air_RH = <span class="number">0</span>;</span><br><span class="line">    <span class="type">uint16_t</span> eath_H = <span class="number">0</span>;</span><br><span class="line">    <span class="type">uint16_t</span> light = <span class="number">0</span>;</span><br><span class="line">    <span class="type">uint16_t</span> co2 = <span class="number">0</span>;</span><br><span class="line">    <span class="type">uint16_t</span> tvoc = <span class="number">0</span>;</span><br><span class="line">    <span class="type">float</span> h2 = <span class="number">0</span>;</span><br><span class="line">    <span class="type">float</span> eth = <span class="number">0</span>;</span><br><span class="line">&#125; data;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Serial.<span class="built_in">begin</span>(<span class="number">115200</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建 JSON 文档</span></span><br><span class="line">    StaticJsonDocument&lt;<span class="number">256</span>&gt; doc;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    doc[<span class="string">&quot;air_tmp&quot;</span>] = air_tmp;</span><br><span class="line">    doc[<span class="string">&quot;air_RH&quot;</span>]  = air_RH;</span><br><span class="line">    doc[<span class="string">&quot;eath_H&quot;</span>]  = eath_H;</span><br><span class="line">    doc[<span class="string">&quot;light&quot;</span>]   = light;</span><br><span class="line">    doc[<span class="string">&quot;co2&quot;</span>]     = co2;</span><br><span class="line">    doc[<span class="string">&quot;tvoc&quot;</span>]    = voc;</span><br><span class="line">    doc[<span class="string">&quot;h2&quot;</span>]      = h2;</span><br><span class="line">    doc[<span class="string">&quot;eth&quot;</span>]     = eth;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> cstr[<span class="number">256</span>]; </span><br><span class="line">    <span class="built_in">serializeJson</span>(doc, cstr, <span class="built_in">sizeof</span>(cstr));</span><br><span class="line">    <span class="comment">//到这里数据就转换成JSON格式的字符串 cstr了</span></span><br><span class="line">    Serial.<span class="built_in">println</span>(cstr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="总结与展望"><a href="#总结与展望" class="headerlink" title="总结与展望"></a>总结与展望</h2><ul>
<li><p>项目成果</p>
<ul>
<li>项目实现了数据采集并实时上传</li>
<li>使用SSL加密</li>
<li>学习了MQTT协议</li>
</ul>
</li>
<li><p>可以拓展的方向</p>
<ol>
<li>后端尚未开发，可以开发后端</li>
<li>硬件与预想时剔除了水泵，但是扩展板存在电机驱动电路，可以添加上</li>
<li>若要添加水泵，可以采用订阅MQTT</li>
</ol>
</li>
</ul>
<p>参考资料：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.taichi-maker.com/">太极创客 – Arduino，人工智能，物联网的应用、开发和学习资料</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dvarrel/DHT22">github.com&#x2F;dvarrel&#x2F;DHT22</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/RobTillaart/SGP30">GitHub - RobTillaart&#x2F;SGP30: Arduino library for SGP30 environment sensor</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/claws/BH1750">GitHub - claws&#x2F;BH1750</a></li>
<li>ESP8266 Arduino Core Documentation Release 2.4.0</li>
<li><a target="_blank" rel="noopener" href="https://test.mosquitto.org/">test.mosquitto.org</a></li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/image/pcfx.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/image/pcfx.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">pcfx</div><div class="post-copyright__author_desc">日拱一卒</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/09/29/%E5%9F%BA%E4%BA%8E-Arduino-ESP8266-%E7%9A%84%E6%99%BA%E6%85%A7%E5%86%9C%E4%B8%9A%E5%A4%A7%E6%A3%9A%E9%A1%B9%E7%9B%AE/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/09/29/%E5%9F%BA%E4%BA%8E-Arduino-ESP8266-%E7%9A%84%E6%99%BA%E6%85%A7%E5%86%9C%E4%B8%9A%E5%A4%A7%E6%A3%9A%E9%A1%B9%E7%9B%AE/')">基于 Arduino ESP8266 的智慧农业大棚项目</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/09/29/%E5%9F%BA%E4%BA%8E-Arduino-ESP8266-%E7%9A%84%E6%99%BA%E6%85%A7%E5%86%9C%E4%B8%9A%E5%A4%A7%E6%A3%9A%E9%A1%B9%E7%9B%AE/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">pcfx</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>嵌入式<span class="tagsPageCount">1</span></a></div></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2025/09/19/MySQL%E5%AE%89%E8%A3%85%E6%8A%A5%E9%94%992738%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pcfx.oss-cn-heyuan.aliyuncs.com/markdown/img/IMG_365.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MySQL 安装报错 2738 解决方法</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/image/pcfx.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://twikoo-magic.oss-cn-hangzhou.aliyuncs.com/Tsuri-me-ju_mimi/10753784_key@2x.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">“The greatest glory in living lies not in never failing, but in rising every time we fall.”</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">人生的光辉不在于从不跌倒，而在于每次跌倒后重新站起。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">pcfx</h1><div class="author-info__desc">日拱一卒</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/PCFXPCFX" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-Arduino-ESP8266-%E7%9A%84%E6%99%BA%E6%85%A7%E5%86%9C%E4%B8%9A%E5%A4%A7%E6%A3%9A%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text">基于 Arduino ESP8266 的智慧农业大棚项目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">引言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%A1%AC%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.</span> <span class="toc-text">项目硬件介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%9AESP8266"><span class="toc-number">1.2.1.</span> <span class="toc-text">核心控制器：ESP8266</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E6%84%9F%E5%99%A8%E9%83%A8%E5%88%86"><span class="toc-number">1.2.2.</span> <span class="toc-text">传感器部分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%8A%9F%E8%83%BD"><span class="toc-number">1.3.</span> <span class="toc-text">项目设计与功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B"><span class="toc-number">1.4.</span> <span class="toc-text">总结与展望</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/09/29/%E5%9F%BA%E4%BA%8E-Arduino-ESP8266-%E7%9A%84%E6%99%BA%E6%85%A7%E5%86%9C%E4%B8%9A%E5%A4%A7%E6%A3%9A%E9%A1%B9%E7%9B%AE/" title="基于 Arduino ESP8266 的智慧农业大棚项目"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pcfx.oss-cn-heyuan.aliyuncs.com/markdown/img/seed_image.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于 Arduino ESP8266 的智慧农业大棚项目"/></a><div class="content"><a class="title" href="/2025/09/29/%E5%9F%BA%E4%BA%8E-Arduino-ESP8266-%E7%9A%84%E6%99%BA%E6%85%A7%E5%86%9C%E4%B8%9A%E5%A4%A7%E6%A3%9A%E9%A1%B9%E7%9B%AE/" title="基于 Arduino ESP8266 的智慧农业大棚项目">基于 Arduino ESP8266 的智慧农业大棚项目</a><time datetime="2025-09-29T08:39:02.000Z" title="发表于 2025-09-29 16:39:02">2025-09-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/19/MySQL%E5%AE%89%E8%A3%85%E6%8A%A5%E9%94%992738%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" title="MySQL 安装报错 2738 解决方法"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pcfx.oss-cn-heyuan.aliyuncs.com/markdown/img/IMG_365.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL 安装报错 2738 解决方法"/></a><div class="content"><a class="title" href="/2025/09/19/MySQL%E5%AE%89%E8%A3%85%E6%8A%A5%E9%94%992738%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" title="MySQL 安装报错 2738 解决方法">MySQL 安装报错 2738 解决方法</a><time datetime="2025-09-19T13:29:23.000Z" title="发表于 2025-09-19 21:29:23">2025-09-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/21/%E4%B8%80%E6%AC%A1GitHub%E5%AD%A6%E7%94%9F%E8%AE%A4%E8%AF%81%E8%AE%B0%E5%BD%95/" title="一次GitHub学生认证记录"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pcfx.oss-cn-heyuan.aliyuncs.com/markdown/img/578UR-Hoshizora-Rin-I-m-a-Scaaary-Werewolf-Rahhh-Halloween-Dress-Up-OECEeg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="一次GitHub学生认证记录"/></a><div class="content"><a class="title" href="/2025/07/21/%E4%B8%80%E6%AC%A1GitHub%E5%AD%A6%E7%94%9F%E8%AE%A4%E8%AF%81%E8%AE%B0%E5%BD%95/" title="一次GitHub学生认证记录">一次GitHub学生认证记录</a><time datetime="2025-07-21T14:31:48.000Z" title="发表于 2025-07-21 22:31:48">2025-07-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/20/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E7%9A%84%E6%9C%AC%E8%B4%A8/" title="线性代数的本质"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pcfx.oss-cn-heyuan.aliyuncs.com/markdown/img/28c1f077e6e9befaab2f4416fde904ff930bca92.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="线性代数的本质"/></a><div class="content"><a class="title" href="/2025/07/20/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E7%9A%84%E6%9C%AC%E8%B4%A8/" title="线性代数的本质">线性代数的本质</a><time datetime="2025-07-20T15:01:23.000Z" title="发表于 2025-07-20 23:01:23">2025-07-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/10/%E5%8F%8C%E6%8C%87%E9%92%88%EF%BC%8C%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3/" title="双指针，滑动窗口"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pcfx.oss-cn-heyuan.aliyuncs.com/markdown/img/1600px-Image_card_full_10335011.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="双指针，滑动窗口"/></a><div class="content"><a class="title" href="/2025/05/10/%E5%8F%8C%E6%8C%87%E9%92%88%EF%BC%8C%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3/" title="双指针，滑动窗口">双指针，滑动窗口</a><time datetime="2025-05-09T16:00:00.000Z" title="发表于 2025-05-10 00:00:00">2025-05-10</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 By <a class="footer-bar-link" href="/" title="pcfx" target="_blank">pcfx</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://icp.gov.moe/?keyword=20254488" title="萌ICP备20254488号">萌ICP备20254488号</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">9</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">2</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/%E5%AD%A6%E4%B9%A0"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/projects/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 项目</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=2038751471&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于网站</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size: 0.88rem;">AI<sup>1</sup></a><a href="/tags/C-C/" style="font-size: 0.88rem;">C/C++<sup>1</sup></a><a href="/tags/GitHub/" style="font-size: 0.88rem;">GitHub<sup>1</sup></a><a href="/tags/Markdown/" style="font-size: 0.88rem;">Markdown<sup>1</sup></a><a href="/tags/MySQL/" style="font-size: 0.88rem;">MySQL<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" style="font-size: 0.88rem;">嵌入式<sup>1</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 0.88rem;">数学<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">算法<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="2038751471" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.5"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("11/02/2025 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2025 By 安知鱼 V1.6.15",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 pcfx 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://cdn.cbd.int/qrcodejs@1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>